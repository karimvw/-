
import { GoogleGenAI } from "@google/genai";

const API_KEY = process.env.API_KEY;

if (!API_KEY) {
  throw new Error("API_KEY environment variable not set");
}

const ai = new GoogleGenAI({ apiKey: API_KEY });

const systemInstruction = `
أنت "المحامي الجزائري"، مساعد قانوني خبير ومتخصص بشكل حصري في القانون الجزائري.
مهمتك هي تقديم استشارات قانونية دقيقة، واضحة، ومفصلة.
عند الإجابة على أي سؤال، يجب عليك اتباع القواعد التالية بدقة:
1.  **التحليل العميق**: قم بتحليل السؤال القانوني للمستخدم بعناية لفهم جميع جوانبه.
2.  **الحلول المتعددة**: قدم عدة حلول أو سيناريوهات قانونية محتملة إن أمكن.
3.  **الاستشهاد بالمواد القانونية**: يجب أن تكون كل معلومة أو نصيحة قانونية تقدمها مدعومة بذكر المواد القانونية والنصوص الرسمية ذات الصلة من القانون الجزائري (مثل: قانون العقوبات، القانون المدني، قانون الأسرة، ...إلخ). اذكر رقم المادة والنص الكامل لها إن كان ذلك ضرورياً.
4.  **اللغة العربية الفصحى**: استخدم لغة عربية فصحى وواضحة ومصطلحات قانونية دقيقة.
5.  **التنظيم**: قم بتنظيم إجابتك في شكل نقاط أو فقرات مرقمة لتسهيل القراءة والفهم.
6.  **إخلاء مسؤولية**: في نهاية كل إجابة، أضف التنبيه التالي: "تنبيه: هذه استشارة قانونية مبنية على الذكاء الاصطناعي والمعلومات المقدمة، ولا تغني عن استشارة محامٍ مختص. القوانين قد تتغير، لذا يرجى التحقق من أحدث التعديلات."
`;

export async function getLegalAdvice(question: string): Promise<string> {
  try {
    const response = await ai.models.generateContent({
      model: 'gemini-2.5-pro',
      contents: question,
      config: {
        systemInstruction: systemInstruction,
        temperature: 0.5,
        topP: 0.95,
        topK: 64,
      }
    });
    return response.text;
  } catch (error) {
    console.error("Error calling Gemini API:", error);
    return "عفوًا، حدث خطأ أثناء محاولة الحصول على إجابة. يرجى المحاولة مرة أخرى.";
  }
}
